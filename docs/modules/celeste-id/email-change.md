# Email Change

## Step 1: Request to Change Email

- **Route**: `POST /api/v1/email-change`

## Step 1: Request

- **Request Headers**:

  ```json
  {
    "Authorization": "Bearer jwt-token"
  }
  ```

- **Request Body**:

  ```json
  {
    "newEmail": "newemail@example.com"
  }
  ```

## Step 1: Validation Rules

- **New Email**

  - Must be a valid email format.
  - Must not be the same as the current email.
  - Must be unique (not already in use by another account).

## Step 1: Response

- **Response** (200. Ok):

  ```json
  {
    "message": "Email change request initiated, please confirm your new email"
  }
  ```

- **Response** (400. Validation Error - Invalid Email):

  ```json
  {
    "error": "New email is invalid"
  }
  ```

- **Response** (400. Validation Error - Same Email):

  ```json
  {
    "error": "New email cannot be the same as the current email"
  }
  ```

- **Response** (401. Authentication Error):

  ```json
  {
    "error": "Unauthorized"
  }
  ```

- **Response** (409. Conflict Error - Email Already Exists):

  ```json
  {
    "error": "Email is already associated with another account"
  }
  ```

- **Response** (500. Server Error):

  ```json
  {
    "error": "Internal server error. Please try again later."
  }
  ```

## Step 2: Confirm New Email (via Email Link)

- **Route**: `POST /api/v1/email-confirm?token=confirmation_token_here`

## Step 2: Validation Rules

- **Token**

  - Must be a valid token generated by the server during the email change request.
  - The token should contain the user ID and new email.

## Step 2: Response

- **Response** (200. Ok):

  ```json
  {
    "message": "Email successfully updated"
  }
  ```

- **Response** (400. Validation Error - Invalid or Expired Token):

  ```json
  {
    "error": "The provided token is invalid or has expired"
  }
  ```

- **Response** (500. Server Error):

  ```json
  {
    "error": "Internal server error. Please try again later."
  }
  ```
